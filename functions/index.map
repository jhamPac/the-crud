{"version":3,"sources":["firebaseSingleton.js","graphql/resolvers.js","graphql/schema.js","source.js"],"names":["admin","require","functions","initializeApp","config","firebase","resolveFunctions","foodDoc","foodInfo","FOOD_REF","get","catch","err","Error","data","Object","keys","reduce","info","acc","key","index","concat","getFoodSupply","root","label","inStock","payload","update","addFoodToSupply","fireStore","firestore","collection","doc","Query","Mutation","typeDefs","gql","resolvers","gqlServer","ApolloServer","schema","playground","api","https","onRequest","createHandler","cors","origin","vulcan","document","onWrite","change","context","console","log","before","after"],"mappings":"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","file":"index.map","sourceRoot":"","sourcesContent":["const admin     = require('firebase-admin')\nconst functions = require('firebase-functions')\n\n// FireBase setup\nadmin.initializeApp(functions.config().firebase)\n\nexport { admin, functions }\n","import { admin } from '../firebaseSingleton'\n\nconst fireStore = admin.firestore()\nconst FOOD_REF  = fireStore.collection('provisions').doc('food')\n\nasync function getFoodSupply() {\n  const foodDoc = await FOOD_REF.get().catch(err => {\n    throw new Error(err)\n  })\n\n  const foodInfo       = foodDoc.data()\n  const createFoodItem = info => (acc, key, index) => {\n    return acc.concat(info[key])\n  }\n\n  return Object.keys(foodInfo).reduce(createFoodItem(foodInfo), [])\n}\n\nasync function addFoodToSupply(root, { label, inStock }) {\n  const payload = {\n    [label]: {\n      label,\n      inStock\n    }\n  }\n\n  await FOOD_REF.update(payload)\n\n  return payload[label]\n}\n\n\nconst resolveFunctions = {\n  Query: {\n    getFoodSupply\n  },\n\n  Mutation: {\n    addFoodToSupply\n  }\n}\n\nexport default resolveFunctions\n","import { gql } from 'apollo-server-cloud-functions'\n\nimport resolvers from \"./resolvers\"\n\nconst typeDefs = gql`\n  type Food {\n    id: ID!\n    label: String\n    inStock: Int\n  }\n\n  # the schema allows the following query:\n  type Query {\n    getFoodSupply: [Food]\n  }\n\n  # this schema allows the following mutation:\n  type Mutation {\n    addFoodToSupply(label: String!, inStock: Int!): Food\n  }\n`\n\nexport default {\n  typeDefs,\n  resolvers\n}\n","import { functions } from './firebaseSingleton'\n\n// GraphQL\nimport { ApolloServer }   from 'apollo-server-cloud-functions'\nimport schema             from './graphql/schema'\n\nconst gqlServer = new ApolloServer({\n  ...schema,\n  playground: true\n})\n\n// export Firebase function handler\nexport const api = functions.https.onRequest(gqlServer.createHandler({\n  cors: {\n    origin: '*'\n  }\n}))\n\nexport const vulcan = functions.firestore.document('provisions/food').onWrite((change, context) => {\n  console.log(change.before.data())\n  console.log(change.after.data())\n})\n"]}